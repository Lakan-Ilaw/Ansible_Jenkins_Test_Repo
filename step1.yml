---
- name: Run Maven Build
  hosts: master
  become: yes
  vars:
    git_repo_url: https://github.com/Lakan-Ilaw/java-tomcat-sample.git
    project_directory: /home/labsuser/TEST_FOLDER/Test2/
  tasks:
    - name: Verify Maven
      apt:
        name: maven
        update_cache: true
  tasks:
    - name: Check if the project directory exists
      stat:
        path: "{{ project_directory }}"
      register: project_dir

    - name: Clone the Git repository
      git:
        repo: "{{ git_repo_url }}"
        dest: "{{ project_directory }}"
      when: project_dir.stat.exists == False

    - name: Run Maven Goals
      command: mvn "{{ item }}"
      args:
        chdir: "{{ project_directory }}"
      loop:
        - test
        - pmd:pmd
        - verify
        - clean install
